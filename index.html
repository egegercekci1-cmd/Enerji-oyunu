<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight * 0.75;

const g = 0.015;
const L = canvas.height * 0.45;

let angle = Math.PI / 6;
let speed = 0;
let dragging = false;

// ðŸ”¢ Enerji ayarlarÄ±
const TOTAL = 100;
let shownPot = 50;
let shownKin = 50;

const origin = {
  x: canvas.width / 2,
  y: canvas.height * 0.15
};

// ðŸ‘† Dokunma
canvas.addEventListener("touchstart", () => dragging = true);

canvas.addEventListener("touchmove", e => {
  if (!dragging) return;
  const t = e.touches[0];
  const r = canvas.getBoundingClientRect();
  const x = t.clientX - r.left - origin.x;
  const y = t.clientY - r.top - origin.y;
  angle = Math.atan2(x, y);
  speed = 0;
});

canvas.addEventListener("touchend", () => dragging = false);

function update() {
  if (!dragging) {
    speed += -g * Math.sin(angle);
    speed *= 0.995;
    angle += speed;
  }
}

function drawBar(x, y, value, color, label) {
  const width = 200;
  const height = 18;

  ctx.strokeStyle = "white";
  ctx.strokeRect(x, y, width, height);

  ctx.fillStyle = color;
  ctx.fillRect(x, y, width * (value / TOTAL), height);

  ctx.fillStyle = "white";
  ctx.font = "14px Arial";
  ctx.fillText(label + ": " + value.toFixed(0), x, y - 4);
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const x = origin.x + L * Math.sin(angle);
  const y = origin.y + L * Math.cos(angle);

  // ip
  ctx.beginPath();
  ctx.moveTo(origin.x, origin.y);
  ctx.lineTo(x, y);
  ctx.strokeStyle = "white";
  ctx.lineWidth = 2;
  ctx.stroke();

  // top
  ctx.beginPath();
  ctx.arc(x, y, 22, 0, Math.PI * 2);
  ctx.fillStyle = "orange";
  ctx.fill();

  // ðŸ”¢ GerÃ§ek enerji
  let realPot = (1 - Math.cos(angle)) * TOTAL;
  realPot = Math.min(realPot, TOTAL);
  let realKin = TOTAL - realPot;

  // ðŸ§ˆ YumuÅŸatma
  const smooth = 0.05;
  shownPot += (realPot - shownPot) * smooth;
  shownKin += (realKin - shownKin) * smooth;

  // ðŸ“Š Enerji barlarÄ±
  drawBar(20, canvas.height - 80, shownPot, "#3498db", "Potansiyel");
  drawBar(20, canvas.height - 50, shownKin, "#e74c3c", "Kinetik");

  ctx.fillStyle = "white";
  ctx.font = "16px Arial";
  ctx.fillText("Toplam Enerji: 100", 20, canvas.height - 110);
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>